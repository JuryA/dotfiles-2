# thanks:
# http://pbrisbin.com/posts/mutt_gmail_offlineimap
# https://github.com/sjl/dotfiles/blob/master/mutt

# viewing, managing
set folder = ~/Mail
set mbox_type = Maildir
set record = +sent
set postponed = +drafts
set nomove
set delete
set noconfirmappend
set nomark_old
set quit
set sort = threads
set sort_aux = reverse-last-date-received
set sort_re
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"
set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+""])"
set nobeep
set smart_wrap
set tilde
set nomarkers
set menu_scroll
set pager_stop
set pager_context = 3
ignore *
unignore from: to: cc: date: subject:
hdr_order from: to: cc: date: subject:
alternative_order text/plain text/enriched text/html
set sidebar_delim = '  â”‚'
set sidebar_visible
set sidebar_width = 30
set rfc2047_parameters
charset-hook US-ASCII     ISO-8859-1
charset-hook x-unknown    ISO-8859-1
charset-hook windows-1251 CP1251
set config_charset = utf-8
set editor = "$EDITOR +/^$"
set auto_tag

## formats
set date_format = "%m/%d"
set index_format = "[%Z]  %D  %-20.20F  %s"
set status_format = "-%r- %v ---[ Folder: %f, Msgs: %m%?n? New: %n?%?d? Del: %d?%?t? Tag: %t?%?l? %l? ]%?p?---- .: %p waiting to send :. ?--%>- (%P) ---"
set alias_format = "%4n %t %-20a  %r"]

## keys
bind editor <space> noop # allows using IMAP folders w/ spaces!
bind editor <tab> complete-query
bind editor ^T    complete
bind index,pager <down>   sidebar-next
bind index,pager <up>     sidebar-prev
bind index,pager <right>  sidebar-open
bind index,pager R group-reply
bind index <space> collapse-thread
bind index k next-entry
bind index j previous-entry
bind index gg first-entry
bind index G last-entry
macro index / \
      "<enter-command>set nowait_key<enter><shell-escape>mutt-notmuch --prompt search<enter><change-folder-readonly>~/.cache/mutt_results<enter>" \
      "search mail (using notmuch)"
macro index T \
      "<enter-command>set nowait_key<enter><pipe-message>mutt-notmuch thread<enter><change-folder-readonly>~/.cache/mutt_results<enter><enter-command>set wait_key<enter>" \
      "search and reconstruct owning thread (using notmuch)"
macro index C "<copy-message>?<toggle-mailboxes>" "copy a message to a mailbox"
macro index M "<save-message>?<toggle-mailboxes>" "move a message to a mailbox"
macro index a "<limit>all\n" "show all messages (undo limit)"
bind attach k next-entry
bind attach j previous-entry
bind attach <return> view-mailcap
bind pager / search
bind pager k next-line
bind pager j previous-line
bind pager p previous-entry
bind pager n next-entry
bind pager gg top
bind pager G bottom
macro pager \Cu "|urlview<enter>"

# attachments
set mailcap_path = ~/.mutt/mailcap
auto_view text/html

# sending
set query_command = '~/Code/dotfiles/bin/addressbook %s'
set sendmail = /usr/local/bin/msmtp
set sendmail_wait = 0
set envelope_from
set nomime_forward
set include
set forward_quote
set forward_format = "Fwd: %s"
set attribution = "On %d, %n wrote:"
set reply_to
set reverse_name
set sig_dashes
set edit_headers
set fast_reply
set askcc
set send_charset = "utf-8:windows-1251:us-ascii:iso-8859-1"

# identity
alternates ^greg@wm\\.ru$ ^floatboth@me\\.com$
set reverse_name

# accounts
folder-hook iCloud/* source ~/.mutt/icloud.muttrc
folder-hook WM/* source ~/.mutt/wm.muttrc

source ~/.mutt/solarized/mutt-colors-solarized-`if [[ $SOLARIZED == "" ]]; then echo "light"; else echo $SOLARIZED; fi`-16.muttrc
source ~/.mailboxes.muttrc
source ~/.local.muttrc
