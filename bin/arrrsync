#!/usr/bin/env python
import os
import datetime
from fsevents import Observer, Stream
from pymongo import Connection

coll = Connection()["code-stat"]["stat"]
h = os.environ["HOME"]

def backup(path):
    path = h + "/" + path
    def cb(ev):
        coll.insert({"path": ev.name, "mask": ev.mask, "time": datetime.datetime.now()})
        os.system("rsync -az --delete %s myfreeweb@myfreeweb.strongspace.com:/strongspace/myfreeweb/home" % path.replace(' ', '\ '))
    observer = Observer()
    observer.schedule(Stream(cb, path, file_events=True))
    observer.start()

backup("Library/Application Support/TextExpander")
backup("Code/private")
